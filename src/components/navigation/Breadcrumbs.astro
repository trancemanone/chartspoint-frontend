---
/**
 * Breadcrumbs Component - Elegant Navigation Trail
 *
 * Sophisticated breadcrumb navigation featuring:
 * - Home icon on right (RTL)
 * - Chevron separators
 * - Current page highlighted
 * - Schema.org BreadcrumbList markup for SEO
 *
 * Optimized for Arabic readers ages 40-70 with WCAG AAA compliance.
 */

export interface BreadcrumbItem {
  label: string;
  href: string;
  current?: boolean;
}

export interface Props {
  items: BreadcrumbItem[];
  ariaLabel?: string;
  variant?: 'default' | 'light' | 'dark';
}

const {
  items,
  ariaLabel = 'مسار التنقل',
  variant = 'default'
} = Astro.props;

// Ensure we have at least one item
const breadcrumbItems = items.length > 0 ? items : [{ label: 'الرئيسية', href: '/' }];

// Generate Schema.org BreadcrumbList structured data
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbItems.map((item, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": item.label,
    "item": item.current ? undefined : new URL(item.href, Astro.site || 'https://itqqan.com').href
  }))
};

// Determine variant classes
const variantClasses = {
  default: 'breadcrumbs-default',
  light: 'breadcrumbs-light',
  dark: 'breadcrumbs-dark'
};
---

<nav
  class:list={['breadcrumbs', variantClasses[variant]]}
  aria-label={ariaLabel}
>
  <ol class="breadcrumbs-list" role="list">
    {breadcrumbItems.map((item, index) => {
      const isFirst = index === 0;
      const isLast = index === breadcrumbItems.length - 1;
      const isCurrent = item.current || isLast;

      return (
        <li class="breadcrumbs-item">
          {isCurrent ? (
            <span
              class="breadcrumbs-current"
              aria-current="page"
            >
              {isFirst && (
                <span class="breadcrumbs-home-icon" aria-hidden="true">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                  </svg>
                </span>
              )}
              <span class="breadcrumbs-text">{item.label}</span>
            </span>
          ) : (
            <>
              <a
                href={item.href}
                class="breadcrumbs-link"
              >
                {isFirst && (
                  <span class="breadcrumbs-home-icon" aria-hidden="true">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                      <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                  </span>
                )}
                <span class="breadcrumbs-text">{item.label}</span>
              </a>
              <span class="breadcrumbs-separator" aria-hidden="true">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="breadcrumbs-chevron"
                >
                  <polyline points="15 18 9 12 15 6"/>
                </svg>
              </span>
            </>
          )}
        </li>
      );
    })}
  </ol>
</nav>

<!-- Schema.org BreadcrumbList structured data -->
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

<style>
  /* ═══════════════════════════════════════════════════════════════════════════
     BREADCRUMBS BASE STYLES
     ═══════════════════════════════════════════════════════════════════════════ */

  .breadcrumbs {
    margin: 1.25rem 0 1.75rem;
    padding: 0;
  }

  @media (min-width: 768px) {
    .breadcrumbs {
      margin: 1.5rem 0 2rem;
    }
  }

  .breadcrumbs-list {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem;
    list-style: none;
    padding: 0;
    margin: 0;
    font-size: 0.9375rem;
  }

  @media (min-width: 768px) {
    .breadcrumbs-list {
      font-size: 1rem;
      gap: 0.625rem;
    }
  }

  .breadcrumbs-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  @media (min-width: 768px) {
    .breadcrumbs-item {
      gap: 0.625rem;
    }
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     LINK STYLES
     ═══════════════════════════════════════════════════════════════════════════ */

  .breadcrumbs-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0;
    min-height: 44px;
    font-weight: 500;
    text-decoration: none;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
  }

  /* Default variant link colors */
  .breadcrumbs-default .breadcrumbs-link {
    color: theme('colors.brand.600');
  }

  .breadcrumbs-default .breadcrumbs-link:hover {
    color: theme('colors.brand.700');
  }

  /* Light variant (for use on dark backgrounds) */
  .breadcrumbs-light .breadcrumbs-link {
    color: rgba(255, 255, 255, 0.85);
  }

  .breadcrumbs-light .breadcrumbs-link:hover {
    color: white;
  }

  /* Dark variant */
  .breadcrumbs-dark .breadcrumbs-link {
    color: theme('colors.navy.600');
  }

  .breadcrumbs-dark .breadcrumbs-link:hover {
    color: theme('colors.navy.800');
  }

  /* Link underline effect */
  .breadcrumbs-link .breadcrumbs-text {
    position: relative;
  }

  .breadcrumbs-link .breadcrumbs-text::after {
    content: '';
    position: absolute;
    bottom: -2px;
    right: 0;
    left: 0;
    height: 2px;
    background: currentColor;
    opacity: 0.4;
    border-radius: 1px;
    transform: scaleX(1);
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  .breadcrumbs-link:hover .breadcrumbs-text::after {
    opacity: 0.8;
  }

  /* Focus styles */
  .breadcrumbs-link:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px theme('colors.brand.500 / 30%');
  }

  .breadcrumbs-link:focus-visible .breadcrumbs-text::after {
    transform: scaleX(0);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     CURRENT PAGE STYLES
     ═══════════════════════════════════════════════════════════════════════════ */

  .breadcrumbs-current {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0;
    min-height: 44px;
    font-weight: 600;
  }

  .breadcrumbs-default .breadcrumbs-current {
    color: theme('colors.navy.700');
  }

  .breadcrumbs-light .breadcrumbs-current {
    color: white;
  }

  .breadcrumbs-dark .breadcrumbs-current {
    color: theme('colors.navy.900');
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     HOME ICON STYLES
     ═══════════════════════════════════════════════════════════════════════════ */

  .breadcrumbs-home-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    opacity: 0.85;
    transition: opacity 0.2s ease;
  }

  .breadcrumbs-link:hover .breadcrumbs-home-icon {
    opacity: 1;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     SEPARATOR STYLES
     ═══════════════════════════════════════════════════════════════════════════ */

  .breadcrumbs-separator {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .breadcrumbs-default .breadcrumbs-separator {
    color: theme('colors.slate.400');
  }

  .breadcrumbs-light .breadcrumbs-separator {
    color: rgba(255, 255, 255, 0.5);
  }

  .breadcrumbs-dark .breadcrumbs-separator {
    color: theme('colors.navy.300');
  }

  .breadcrumbs-chevron {
    width: 16px;
    height: 16px;
    /* Chevron points left in SVG, which is correct for RTL */
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     MOBILE TRUNCATION
     ═══════════════════════════════════════════════════════════════════════════ */

  @media (max-width: 639px) {
    .breadcrumbs-item {
      max-width: 100%;
    }

    .breadcrumbs-text {
      max-width: 180px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* On very small screens, hide middle items and show ellipsis */
    .breadcrumbs-item:not(:first-child):not(:last-child) {
      display: none;
    }

    /* Show ellipsis indicator when items are hidden */
    .breadcrumbs-list:has(.breadcrumbs-item:nth-child(3)) .breadcrumbs-item:first-child::after {
      content: '...';
      margin-right: 0.5rem;
      color: theme('colors.slate.400');
    }
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     REDUCED MOTION
     ═══════════════════════════════════════════════════════════════════════════ */

  @media (prefers-reduced-motion: reduce) {
    .breadcrumbs-link,
    .breadcrumbs-link .breadcrumbs-text::after,
    .breadcrumbs-home-icon {
      transition: none;
    }
  }
</style>
