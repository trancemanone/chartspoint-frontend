---
/**
 * MegaMenu Component - Ultra-Premium Navigation Panel
 *
 * A spectacular, Bloomberg/Goldman Sachs-tier mega menu featuring:
 * - Sophisticated glassmorphism with layered depth
 * - Premium geometric mesh patterns and radial glows
 * - Gold accent system with subtle shimmer effects
 * - Staggered entrance animations with GPU acceleration
 * - Three-column pillar layout with distinct visual identities
 * - Institutional-grade typography and spacing
 * - Full RTL Arabic support with WCAG AAA compliance
 *
 * Design Philosophy:
 * This mega menu represents the pinnacle of luxury fintech design.
 * Every pixel has been crafted to convey trust, authority, and exclusivity.
 * The experience rivals that of Swiss private banks and elite wealth
 * management platforms.
 */

import { getPostsByPillar, transformToArticle } from '../../lib/wordpress';
import { CLUSTERS, type PillarSlug } from '../../lib/types';

export interface Props {
  currentPillar?: 'learn' | 'accounts' | 'trust';
}

const { currentPillar } = Astro.props;

// Fetch articles for each pillar from WordPress
const [learnPosts, accountsPosts, trustPosts] = await Promise.all([
  getPostsByPillar('learn', 6),
  getPostsByPillar('accounts', 6),
  getPostsByPillar('trust', 6),
]);

// Transform posts to articles for easier access
const learnArticles = learnPosts.data.map(transformToArticle);
const accountsArticles = accountsPosts.data.map(transformToArticle);
const trustArticles = trustPosts.data.map(transformToArticle);

// Get clusters for each pillar from the types definition
const learnClusters = CLUSTERS.filter(c => c.pillar === 'learn');
const accountsClusters = CLUSTERS.filter(c => c.pillar === 'accounts');
const trustClusters = CLUSTERS.filter(c => c.pillar === 'trust');

// Build pillar data with premium styling
const pillars = [
  {
    id: 'learn' as PillarSlug,
    label: 'تعلم',
    labelEn: 'Learn',
    href: '/learn',
    description: 'أساسيات الاستثمار والتعليم المالي',
    tagline: 'ابدأ رحلتك نحو الثقافة المالية',
    icon: 'book',
    colorHex: '#3B82F6',
    gradientFrom: '#3B82F6',
    gradientTo: '#1D4ED8',
    glowColor: 'rgba(59, 130, 246, 0.15)',
    clusters: learnClusters.slice(0, 7).map(cluster => ({
      label: cluster.nameAr,
      href: `/learn/${cluster.slug}`,
      description: getClusterDescription(cluster.slug),
    })),
    articles: learnArticles.slice(0, 3),
  },
  {
    id: 'accounts' as PillarSlug,
    label: 'حسابات',
    labelEn: 'Accounts',
    href: '/accounts',
    description: 'افتح حسابك واختر المنصة المناسبة',
    tagline: 'ابدأ التداول مع أفضل المنصات',
    icon: 'wallet',
    colorHex: '#d5a035',
    gradientFrom: '#d5a035',
    gradientTo: '#b8892a',
    glowColor: 'rgba(213, 160, 53, 0.15)',
    clusters: accountsClusters.slice(0, 5).map(cluster => ({
      label: cluster.nameAr,
      href: `/accounts/${cluster.slug}`,
      description: getClusterDescription(cluster.slug),
    })),
    articles: accountsArticles.slice(0, 3),
  },
  {
    id: 'trust' as PillarSlug,
    label: 'ثقة',
    labelEn: 'Trust',
    href: '/trust',
    description: 'تأكد من سلامة استثماراتك',
    tagline: 'استثمر بأمان وثقة تامة',
    icon: 'shield',
    colorHex: '#7C2D3C',
    gradientFrom: '#7C2D3C',
    gradientTo: '#5B1E2B',
    glowColor: 'rgba(124, 45, 60, 0.15)',
    clusters: trustClusters.slice(0, 5).map(cluster => ({
      label: cluster.nameAr,
      href: `/trust/${cluster.slug}`,
      description: getClusterDescription(cluster.slug),
    })),
    articles: trustArticles.slice(0, 3),
  },
];

// Cluster descriptions for richer UX
function getClusterDescription(slug: string): string {
  const descriptions: Record<string, string> = {
    'start': 'مبادئ الاستثمار الأساسية',
    'stocks': 'تعلم أسواق الأسهم',
    'gold': 'الاستثمار في المعادن الثمينة',
    'funds-learn': 'صناديق الاستثمار المتداولة',
    'plan': 'التخطيط المالي الشخصي',
    'analysis': 'التحليل الفني والأساسي',
    'courses': 'دورات تعليمية متخصصة',
    'open': 'خطوات فتح الحساب',
    'platform': 'مقارنة منصات التداول',
    'apps': 'تطبيقات الجوال للتداول',
    'brokers': 'اختيار الوسيط المناسب',
    'sectors': 'قطاعات السوق المختلفة',
    'license': 'التراخيص والتنظيم',
    'checks': 'التحقق من الوسطاء',
    'scams': 'حماية من الاحتيال',
    'funds-trust': 'أمان الأموال',
    'privacy': 'حماية البيانات',
  };
  return descriptions[slug] || '';
}

// Icon SVG paths - refined for premium feel
const icons = {
  book: 'M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25',
  wallet: 'M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z',
  shield: 'M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z',
  arrow: 'M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18',
  sparkle: 'M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z',
};
---

<!-- Premium Contained Mega Menu - Centered Rectangle -->
<div
  id="mega-menu-panel"
  class="mega-menu-panel"
  role="navigation"
  aria-label="القائمة الرئيسية الموسعة"
  data-mega-menu-panel
  hidden
>
  <!-- Layered Background System -->
  <div class="mega-menu-backdrop">
    <!-- Base glassmorphism layer -->
    <div class="backdrop-glass"></div>
    <!-- Geometric mesh pattern overlay -->
    <div class="backdrop-pattern"></div>
    <!-- Pillar glow effects -->
    <div class="backdrop-glow glow-learn"></div>
    <div class="backdrop-glow glow-accounts"></div>
    <div class="backdrop-glow glow-trust"></div>
    <!-- Gold accent line -->
    <div class="backdrop-gold-line"></div>
  </div>

  <!-- Menu Content -->
  <div class="mega-menu-content">
    <div class="container mx-auto px-6 lg:px-8 xl:px-12">
      <!-- Premium 3-Column Pillar Grid -->
      <div class="mega-menu-grid">
        {pillars.map((pillar, pillarIndex) => (
          <div
            class="pillar-column"
            data-pillar-column={pillar.id}
            style={`--pillar-color: ${pillar.colorHex}; --pillar-gradient-from: ${pillar.gradientFrom}; --pillar-gradient-to: ${pillar.gradientTo}; --pillar-glow: ${pillar.glowColor}; --pillar-delay: ${pillarIndex * 80}ms`}
          >
            <!-- Pillar Header with Premium Styling -->
            <div class="pillar-header">
              <!-- Pillar accent bar -->
              <div class="pillar-accent-bar" aria-hidden="true"></div>

              <!-- Icon container with glow -->
              <div class="pillar-icon-container">
                <div class="pillar-icon-glow" aria-hidden="true"></div>
                <div class="pillar-icon-wrapper">
                  <svg
                    class="pillar-icon"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="1.5"
                    aria-hidden="true"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" d={icons[pillar.icon as keyof typeof icons]} />
                  </svg>
                </div>
              </div>

              <!-- Header text content -->
              <div class="pillar-header-content">
                <div class="pillar-title-group">
                  <h3 class="pillar-title">{pillar.label}</h3>
                  <span class="pillar-title-en">{pillar.labelEn}</span>
                </div>
                <p class="pillar-description">{pillar.description}</p>
              </div>
            </div>

            <!-- Cluster Links with Premium Hover States -->
            <div class="pillar-clusters">
              {pillar.clusters.map((cluster, clusterIndex) => (
                <a
                  href={cluster.href}
                  class="cluster-link"
                  role="menuitem"
                  tabindex="-1"
                  data-cluster-link
                  style={`--cluster-delay: ${(pillarIndex * 80) + (clusterIndex * 40) + 100}ms`}
                >
                  <div class="cluster-indicator-wrapper">
                    <span class="cluster-indicator" aria-hidden="true"></span>
                    <span class="cluster-indicator-glow" aria-hidden="true"></span>
                  </div>
                  <div class="cluster-content">
                    <span class="cluster-label">{cluster.label}</span>
                    {cluster.description && (
                      <span class="cluster-desc">{cluster.description}</span>
                    )}
                  </div>
                  <div class="cluster-arrow-wrapper">
                    <svg
                      class="cluster-arrow"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                      aria-hidden="true"
                    >
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                  </div>
                </a>
              ))}
            </div>

            <!-- Featured Articles Section -->
            {pillar.articles.length > 0 && (
              <div class="pillar-articles">
                <div class="articles-header">
                  <svg class="articles-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d={icons.sparkle} />
                  </svg>
                  <span class="articles-heading">أحدث المقالات</span>
                </div>
                <div class="articles-list">
                  {pillar.articles.slice(0, 2).map((article) => (
                    <a
                      href={`/${article.pillar}/${article.cluster}/${article.slug}`}
                      class="article-link"
                      role="menuitem"
                      tabindex="-1"
                      data-cluster-link
                    >
                      <span class="article-bullet" aria-hidden="true"></span>
                      <span class="article-title">{article.title}</span>
                    </a>
                  ))}
                </div>
              </div>
            )}

            <!-- Premium CTA Button -->
            <a
              href={pillar.href}
              class="pillar-cta"
            >
              <span class="pillar-cta-text">استكشف {pillar.label}</span>
              <div class="pillar-cta-icon">
                <svg
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  aria-hidden="true"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
              </div>
              <div class="pillar-cta-shimmer" aria-hidden="true"></div>
            </a>
          </div>
        ))}
      </div>

      <!-- Premium Footer Bar -->
      <div class="mega-menu-footer">
        <div class="footer-content">
          <!-- Trust Indicators -->
          <div class="footer-trust">
            <div class="trust-badge">
              <svg class="trust-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.746 3.746 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.746 3.746 0 011.043 3.296A3.745 3.745 0 0121 12z" />
              </svg>
              <span>محتوى موثوق ومُراجع</span>
            </div>
            <div class="trust-divider"></div>
            <div class="trust-badge">
              <svg class="trust-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
              </svg>
              <span>+200 مقال تعليمي</span>
            </div>
          </div>

          <!-- Quick Links -->
          <div class="footer-links">
            <a href="/about" class="footer-link">
              <span>من نحن</span>
            </a>
            <span class="footer-link-divider"></span>
            <a href="/contact" class="footer-link">
              <span>تواصل معنا</span>
            </a>
            <span class="footer-link-divider"></span>
            <a href="/faq" class="footer-link footer-link-gold">
              <span>الأسئلة الشائعة</span>
              <svg class="footer-link-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* ═══════════════════════════════════════════════════════════════════════════════
     PREMIUM MEGA MENU - Contained Rectangle Design
     Institutional-grade navigation panel with sophisticated visual effects
     Centered below header with clean, contained appearance
     ═══════════════════════════════════════════════════════════════════════════════ */

  .mega-menu-panel {
    position: absolute;
    top: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%) translateY(-12px) scale(0.98);
    width: calc(100% - 2rem);
    max-width: 1280px;
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.3s cubic-bezier(0.16, 1, 0.3, 1),
      visibility 0.3s cubic-bezier(0.16, 1, 0.3, 1),
      transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    pointer-events: none;
    will-change: transform, opacity;
  }

  .mega-menu-panel[hidden] {
    display: block;
  }

  .mega-menu-panel.is-open {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(0) scale(1);
    pointer-events: auto;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     LAYERED BACKDROP SYSTEM - Premium Glassmorphism with Rounded Corners
     ═══════════════════════════════════════════════════════════════════════════════ */

  .mega-menu-backdrop {
    position: absolute;
    inset: 0;
    overflow: hidden;
    border-radius: 1.25rem;
  }

  /* Base glass layer */
  .backdrop-glass {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.98) 0%,
      rgba(250, 251, 252, 0.97) 100%
    );
    backdrop-filter: blur(24px) saturate(200%);
    -webkit-backdrop-filter: blur(24px) saturate(200%);
    border: 1px solid rgba(226, 232, 240, 0.7);
    border-radius: 1.25rem;
    box-shadow:
      0 25px 80px rgba(15, 23, 42, 0.12),
      0 12px 40px rgba(15, 23, 42, 0.08),
      0 4px 16px rgba(15, 23, 42, 0.05),
      inset 0 1px 0 rgba(255, 255, 255, 0.9);
  }

  /* Geometric mesh pattern */
  .backdrop-pattern {
    position: absolute;
    inset: 0;
    background-image:
      radial-gradient(circle at 1px 1px, rgba(16, 41, 65, 0.03) 1px, transparent 0);
    background-size: 24px 24px;
    border-radius: 1.25rem;
    opacity: 0;
    transition: opacity 0.5s ease 0.1s;
  }

  .mega-menu-panel.is-open .backdrop-pattern {
    opacity: 1;
  }

  /* Pillar glow effects */
  .backdrop-glow {
    position: absolute;
    width: 300px;
    height: 200px;
    border-radius: 50%;
    filter: blur(60px);
    opacity: 0;
    transition: opacity 0.6s ease 0.15s;
    pointer-events: none;
  }

  .mega-menu-panel.is-open .backdrop-glow {
    opacity: 1;
  }

  .glow-learn {
    top: -30px;
    right: 15%;
    background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
  }

  .glow-accounts {
    top: 30%;
    left: 50%;
    transform: translateX(-50%);
    background: radial-gradient(circle, rgba(213, 160, 53, 0.08) 0%, transparent 70%);
  }

  .glow-trust {
    top: -20px;
    left: 15%;
    background: radial-gradient(circle, rgba(124, 45, 60, 0.08) 0%, transparent 70%);
  }

  /* Gold accent line at top */
  .backdrop-gold-line {
    position: absolute;
    top: 0;
    left: 1.25rem;
    right: 1.25rem;
    height: 3px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(213, 160, 53, 0.3) 15%,
      rgba(213, 160, 53, 0.7) 35%,
      #d5a035 50%,
      rgba(213, 160, 53, 0.7) 65%,
      rgba(213, 160, 53, 0.3) 85%,
      transparent 100%
    );
    border-radius: 0 0 2px 2px;
    transform: scaleX(0);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1) 0.1s;
  }

  .mega-menu-panel.is-open .backdrop-gold-line {
    transform: scaleX(1);
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     MENU CONTENT CONTAINER
     ═══════════════════════════════════════════════════════════════════════════════ */

  .mega-menu-content {
    position: relative;
    z-index: 1;
    padding: 2rem 0 1.5rem;
    border-radius: 1.25rem;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     PREMIUM 3-COLUMN PILLAR GRID
     ═══════════════════════════════════════════════════════════════════════════════ */

  .mega-menu-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2.5rem;
    margin-bottom: 2rem;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     PILLAR COLUMN - Staggered Animation
     ═══════════════════════════════════════════════════════════════════════════════ */

  .pillar-column {
    display: flex;
    flex-direction: column;
    opacity: 0;
    transform: translateY(16px);
    animation: pillarReveal 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    animation-delay: var(--pillar-delay, 0ms);
    animation-play-state: paused;
  }

  .mega-menu-panel.is-open .pillar-column {
    animation-play-state: running;
  }

  @keyframes pillarReveal {
    from {
      opacity: 0;
      transform: translateY(16px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     PILLAR HEADER - Premium Design
     ═══════════════════════════════════════════════════════════════════════════════ */

  .pillar-header {
    position: relative;
    display: flex;
    align-items: flex-start;
    gap: 1.25rem;
    padding: 1.5rem;
    background: linear-gradient(
      135deg,
      rgba(248, 250, 252, 0.9) 0%,
      rgba(255, 255, 255, 0.6) 100%
    );
    border-radius: 1.25rem;
    margin-bottom: 1rem;
    border: 1px solid rgba(226, 232, 240, 0.6);
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .pillar-header:hover {
    background: linear-gradient(
      135deg,
      rgba(248, 250, 252, 1) 0%,
      rgba(255, 255, 255, 0.8) 100%
    );
    border-color: rgba(226, 232, 240, 0.8);
    box-shadow: 0 4px 20px rgba(15, 23, 42, 0.04);
  }

  /* Pillar accent bar */
  .pillar-accent-bar {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: 4px;
    background: linear-gradient(
      180deg,
      var(--pillar-gradient-from) 0%,
      var(--pillar-gradient-to) 100%
    );
    border-radius: 0 1.25rem 1.25rem 0;
  }

  /* Icon container */
  .pillar-icon-container {
    position: relative;
    flex-shrink: 0;
  }

  .pillar-icon-glow {
    position: absolute;
    inset: -8px;
    background: var(--pillar-glow);
    border-radius: 50%;
    filter: blur(12px);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .pillar-header:hover .pillar-icon-glow {
    opacity: 1;
  }

  .pillar-icon-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 3.5rem;
    height: 3.5rem;
    background: linear-gradient(
      135deg,
      color-mix(in srgb, var(--pillar-color) 10%, white) 0%,
      color-mix(in srgb, var(--pillar-color) 5%, white) 100%
    );
    border-radius: 1rem;
    border: 1px solid color-mix(in srgb, var(--pillar-color) 15%, transparent);
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .pillar-header:hover .pillar-icon-wrapper {
    transform: scale(1.05);
    box-shadow: 0 4px 16px var(--pillar-glow);
  }

  .pillar-icon {
    width: 1.75rem;
    height: 1.75rem;
    color: var(--pillar-color);
    transition: transform 0.3s ease;
  }

  .pillar-header:hover .pillar-icon {
    transform: scale(1.1);
  }

  /* Header content */
  .pillar-header-content {
    flex: 1;
    min-width: 0;
  }

  .pillar-title-group {
    display: flex;
    align-items: baseline;
    gap: 0.75rem;
    margin-bottom: 0.375rem;
  }

  .pillar-title {
    font-family: var(--font-heading, 'Noto Kufi Arabic', sans-serif);
    font-size: 1.375rem;
    font-weight: 700;
    color: var(--pillar-color);
    letter-spacing: -0.01em;
    line-height: 1.3;
  }

  .pillar-title-en {
    font-size: 0.75rem;
    font-weight: 600;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .pillar-description {
    font-size: 0.9375rem;
    color: #64748b;
    line-height: 1.6;
    margin: 0;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     CLUSTER LINKS - Premium Hover States
     ═══════════════════════════════════════════════════════════════════════════════ */

  .pillar-clusters {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    flex: 1;
  }

  .cluster-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.875rem 1.125rem;
    border-radius: 0.875rem;
    text-decoration: none;
    opacity: 0;
    transform: translateX(12px);
    animation: clusterReveal 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    animation-delay: var(--cluster-delay, 0ms);
    animation-play-state: paused;
    transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .mega-menu-panel.is-open .cluster-link {
    animation-play-state: running;
  }

  @keyframes clusterReveal {
    from {
      opacity: 0;
      transform: translateX(12px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .cluster-link:hover {
    background: linear-gradient(
      90deg,
      color-mix(in srgb, var(--pillar-color) 6%, white) 0%,
      color-mix(in srgb, var(--pillar-color) 3%, white) 100%
    );
    transform: translateX(-4px);
  }

  .cluster-link:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 2px white,
      0 0 0 4px var(--pillar-color);
    background: color-mix(in srgb, var(--pillar-color) 5%, white);
  }

  /* Cluster indicator */
  .cluster-indicator-wrapper {
    position: relative;
    flex-shrink: 0;
  }

  .cluster-indicator {
    display: block;
    width: 8px;
    height: 8px;
    background: linear-gradient(
      135deg,
      var(--pillar-gradient-from) 0%,
      var(--pillar-gradient-to) 100%
    );
    border-radius: 50%;
    opacity: 0.5;
    transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .cluster-indicator-glow {
    position: absolute;
    inset: -4px;
    background: var(--pillar-color);
    border-radius: 50%;
    filter: blur(6px);
    opacity: 0;
    transition: opacity 0.25s ease;
  }

  .cluster-link:hover .cluster-indicator {
    opacity: 1;
    transform: scale(1.25);
  }

  .cluster-link:hover .cluster-indicator-glow {
    opacity: 0.3;
  }

  /* Cluster content */
  .cluster-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .cluster-label {
    display: block;
    font-size: 0.9375rem;
    font-weight: 600;
    color: #1e293b;
    transition: color 0.2s ease;
  }

  .cluster-link:hover .cluster-label {
    color: #0f172a;
  }

  .cluster-desc {
    display: block;
    font-size: 0.8125rem;
    color: #94a3b8;
    line-height: 1.4;
  }

  .cluster-link:hover .cluster-desc {
    color: #64748b;
  }

  /* Cluster arrow */
  .cluster-arrow-wrapper {
    flex-shrink: 0;
    opacity: 0;
    transform: translateX(8px);
    transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .cluster-link:hover .cluster-arrow-wrapper {
    opacity: 1;
    transform: translateX(0);
  }

  .cluster-arrow {
    width: 1.125rem;
    height: 1.125rem;
    color: var(--pillar-color);
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     FEATURED ARTICLES SECTION
     ═══════════════════════════════════════════════════════════════════════════════ */

  .pillar-articles {
    margin-top: 1.25rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(226, 232, 240, 0.8);
  }

  .articles-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    padding-right: 0.25rem;
  }

  .articles-icon {
    width: 1rem;
    height: 1rem;
    color: #d5a035;
  }

  .articles-heading {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--pillar-color);
  }

  .articles-list {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
  }

  .article-link {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.625rem 0.875rem;
    border-radius: 0.625rem;
    text-decoration: none;
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .article-link:hover {
    background: rgba(248, 250, 252, 0.8);
    transform: translateX(-2px);
  }

  .article-link:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px white, 0 0 0 4px #d5a035;
    background: rgba(248, 250, 252, 0.8);
  }

  .article-bullet {
    flex-shrink: 0;
    width: 5px;
    height: 5px;
    margin-top: 0.5rem;
    background: #d5a035;
    border-radius: 50%;
    opacity: 0.6;
    transition: all 0.2s ease;
  }

  .article-link:hover .article-bullet {
    opacity: 1;
    transform: scale(1.3);
  }

  .article-title {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    font-size: 0.8125rem;
    font-weight: 500;
    color: #475569;
    line-height: 1.5;
    transition: color 0.2s ease;
  }

  .article-link:hover .article-title {
    color: #1e293b;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     PREMIUM CTA BUTTON
     ═══════════════════════════════════════════════════════════════════════════════ */

  .pillar-cta {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.625rem;
    padding: 1rem 1.5rem;
    margin-top: 1rem;
    border-radius: 0.875rem;
    font-size: 0.9375rem;
    font-weight: 600;
    text-decoration: none;
    color: var(--pillar-color);
    background: linear-gradient(
      135deg,
      color-mix(in srgb, var(--pillar-color) 8%, white) 0%,
      color-mix(in srgb, var(--pillar-color) 4%, white) 100%
    );
    border: 1px solid color-mix(in srgb, var(--pillar-color) 18%, transparent);
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .pillar-cta:hover {
    background: linear-gradient(
      135deg,
      color-mix(in srgb, var(--pillar-color) 12%, white) 0%,
      color-mix(in srgb, var(--pillar-color) 8%, white) 100%
    );
    border-color: color-mix(in srgb, var(--pillar-color) 30%, transparent);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px var(--pillar-glow);
  }

  .pillar-cta:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 2px white,
      0 0 0 4px var(--pillar-color),
      0 8px 24px var(--pillar-glow);
  }

  .pillar-cta-text {
    position: relative;
    z-index: 1;
  }

  .pillar-cta-icon {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .pillar-cta-icon svg {
    width: 1.125rem;
    height: 1.125rem;
  }

  .pillar-cta:hover .pillar-cta-icon {
    transform: translateX(-4px);
  }

  /* Gold shimmer effect */
  .pillar-cta-shimmer {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(213, 160, 53, 0.1) 50%,
      transparent 100%
    );
    transition: left 0.5s ease;
  }

  .pillar-cta:hover .pillar-cta-shimmer {
    left: 100%;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     PREMIUM FOOTER BAR
     ═══════════════════════════════════════════════════════════════════════════════ */

  .mega-menu-footer {
    border-top: 1px solid rgba(226, 232, 240, 0.7);
    padding-top: 1.5rem;
  }

  .footer-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
  }

  /* Trust indicators */
  .footer-trust {
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .trust-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .trust-icon {
    width: 1.25rem;
    height: 1.25rem;
    color: #d5a035;
    opacity: 0.9;
  }

  .trust-badge span {
    font-size: 0.875rem;
    font-weight: 500;
    color: #64748b;
  }

  .trust-divider {
    width: 1px;
    height: 1.25rem;
    background: linear-gradient(
      180deg,
      transparent 0%,
      #e2e8f0 50%,
      transparent 100%
    );
  }

  /* Footer links */
  .footer-links {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .footer-link {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: #475569;
    text-decoration: none;
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .footer-link:hover {
    color: #1e293b;
    background: rgba(248, 250, 252, 0.8);
  }

  .footer-link:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px white, 0 0 0 4px #d5a035;
  }

  .footer-link-gold {
    color: #d5a035;
    background: rgba(213, 160, 53, 0.08);
    border: 1px solid rgba(213, 160, 53, 0.15);
  }

  .footer-link-gold:hover {
    color: #b8892a;
    background: rgba(213, 160, 53, 0.12);
    border-color: rgba(213, 160, 53, 0.25);
  }

  .footer-link-icon {
    width: 1rem;
    height: 1rem;
    transition: transform 0.2s ease;
  }

  .footer-link-gold:hover .footer-link-icon {
    transform: translateX(-3px);
  }

  .footer-link-divider {
    width: 1px;
    height: 1rem;
    background: #e2e8f0;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     RESPONSIVE - Hide on mobile (handled by MobileMenu)
     ═══════════════════════════════════════════════════════════════════════════════ */

  @media (max-width: 1023px) {
    .mega-menu-panel {
      display: none !important;
    }
  }

  /* Large screens - enhanced spacing */
  @media (min-width: 1280px) {
    .mega-menu-panel {
      max-width: 1200px;
    }

    .mega-menu-content {
      padding: 2.25rem 0 1.75rem;
    }

    .mega-menu-grid {
      gap: 2.5rem;
    }

    .pillar-header {
      padding: 1.5rem;
    }

    .cluster-link {
      padding: 0.875rem 1.125rem;
    }

    .pillar-cta {
      padding: 1rem 1.5rem;
    }
  }

  /* Extra large screens */
  @media (min-width: 1536px) {
    .mega-menu-panel {
      max-width: 1320px;
    }

    .mega-menu-grid {
      gap: 3rem;
    }
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     REDUCED MOTION - Accessibility
     ═══════════════════════════════════════════════════════════════════════════════ */

  @media (prefers-reduced-motion: reduce) {
    .mega-menu-panel {
      transition: opacity 0.15s ease;
      transform: translateX(-50%);
    }

    .mega-menu-panel.is-open {
      transform: translateX(-50%);
    }

    .pillar-column,
    .cluster-link {
      animation: none;
      opacity: 1;
      transform: none;
    }

    .backdrop-gold-line {
      transition: none;
      transform: scaleX(1);
    }

    .backdrop-pattern,
    .backdrop-glow {
      transition: none;
      opacity: 1;
    }

    .cluster-link:hover,
    .article-link:hover,
    .pillar-cta:hover {
      transform: none;
    }

    .pillar-cta-shimmer {
      display: none;
    }
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     HIGH CONTRAST MODE - Accessibility
     ═══════════════════════════════════════════════════════════════════════════════ */

  @media (prefers-contrast: high) {
    .backdrop-glass {
      background: white;
      border: 2px solid #1e293b;
      border-radius: 1.25rem;
    }

    .pillar-header {
      border: 2px solid currentColor;
    }

    .cluster-link:focus-visible,
    .article-link:focus-visible,
    .pillar-cta:focus-visible,
    .footer-link:focus-visible {
      box-shadow: 0 0 0 3px #000;
      outline: 3px solid #fff;
    }

    .pillar-accent-bar {
      width: 6px;
    }
  }
</style>

<script>
  // Premium MegaMenu - Keyboard Navigation & Interaction Enhancement
  document.addEventListener('DOMContentLoaded', () => {
    const megaMenu = document.querySelector('[data-mega-menu-panel]') as HTMLElement;
    if (!megaMenu) return;

    const clusterLinks = megaMenu.querySelectorAll('[data-cluster-link]');
    const pillarColumns = megaMenu.querySelectorAll('[data-pillar-column]');

    // Enhanced keyboard navigation within mega menu
    clusterLinks.forEach((link) => {
      link.addEventListener('keydown', (e: Event) => {
        const keyEvent = e as KeyboardEvent;
        const currentColumn = (link as HTMLElement).closest('[data-pillar-column]');
        const allLinksInColumn = currentColumn?.querySelectorAll('[data-cluster-link]');

        if (!allLinksInColumn) return;

        const currentIndexInColumn = Array.from(allLinksInColumn).indexOf(link);

        switch (keyEvent.key) {
          case 'ArrowDown':
            keyEvent.preventDefault();
            const nextLink = allLinksInColumn[currentIndexInColumn + 1] || allLinksInColumn[0];
            (nextLink as HTMLElement).focus();
            break;

          case 'ArrowUp':
            keyEvent.preventDefault();
            const prevLink = allLinksInColumn[currentIndexInColumn - 1] || allLinksInColumn[allLinksInColumn.length - 1];
            (prevLink as HTMLElement).focus();
            break;

          case 'ArrowRight': // In RTL, this moves to the previous column
            keyEvent.preventDefault();
            navigateToColumn(-1, currentColumn, currentIndexInColumn);
            break;

          case 'ArrowLeft': // In RTL, this moves to the next column
            keyEvent.preventDefault();
            navigateToColumn(1, currentColumn, currentIndexInColumn);
            break;

          case 'Home':
            keyEvent.preventDefault();
            (allLinksInColumn[0] as HTMLElement).focus();
            break;

          case 'End':
            keyEvent.preventDefault();
            (allLinksInColumn[allLinksInColumn.length - 1] as HTMLElement).focus();
            break;
        }
      });
    });

    // Helper function to navigate between columns
    function navigateToColumn(direction: number, currentColumn: Element | null, currentIndex: number) {
      if (!currentColumn) return;

      const columns = Array.from(pillarColumns);
      const currentColumnIndex = columns.indexOf(currentColumn);
      const targetColumn = columns[currentColumnIndex + direction];

      if (targetColumn) {
        const linksInTargetColumn = targetColumn.querySelectorAll('[data-cluster-link]');
        const targetIndex = Math.min(currentIndex, linksInTargetColumn.length - 1);
        (linksInTargetColumn[targetIndex] as HTMLElement)?.focus();
      }
    }

    // Preload hover states for smoother transitions
    pillarColumns.forEach((column) => {
      column.addEventListener('mouseenter', () => {
        // Trigger GPU acceleration preparation
        (column as HTMLElement).style.willChange = 'transform';
      });

      column.addEventListener('mouseleave', () => {
        // Clean up
        setTimeout(() => {
          (column as HTMLElement).style.willChange = '';
        }, 300);
      });
    });
  });
</script>
