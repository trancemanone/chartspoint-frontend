---
/**
 * MegaMenu Component - ChartsPoint Terminal-Grade Navigation Panel
 *
 * Institutional-grade mega menu with unified design language:
 * - Sophisticated glassmorphism (no multi-color pillar backgrounds)
 * - Custom trading iconography for each pillar
 * - Clean monochromatic palette with strategic teal accents
 * - Bloomberg/Goldman Sachs-tier visual design
 * - Full RTL Arabic support
 * - WCAG AAA compliance
 *
 * Design Philosophy:
 * Remove the colorful pills and pillar-specific backgrounds.
 * Create a cohesive, professional appearance that feels like
 * a high-end trading terminal, not a marketing website.
 */

import { getPostsByPillar, transformToArticle } from '../../lib/wordpress';
import { CLUSTERS, PILLARS, type PillarSlug } from '../../lib/types';

export interface Props {
  currentPillar?: PillarSlug;
}

const { currentPillar } = Astro.props;

// Fetch articles for each pillar from WordPress
const [basicsPosts, indicatorsPosts, toolsPosts, tacticsPosts] = await Promise.all([
  getPostsByPillar('basics', 3).catch(() => ({ data: [] })),
  getPostsByPillar('indicators', 3).catch(() => ({ data: [] })),
  getPostsByPillar('tools', 3).catch(() => ({ data: [] })),
  getPostsByPillar('tactics', 3).catch(() => ({ data: [] })),
]);

// Transform posts to articles
const basicsArticles = basicsPosts.data.map(transformToArticle);
const indicatorsArticles = indicatorsPosts.data.map(transformToArticle);
const toolsArticles = toolsPosts.data.map(transformToArticle);
const tacticsArticles = tacticsPosts.data.map(transformToArticle);

// Get clusters for each pillar
const basicsClusters = CLUSTERS.filter(c => c.pillar === 'basics');
const indicatorsClusters = CLUSTERS.filter(c => c.pillar === 'indicators');
const toolsClusters = CLUSTERS.filter(c => c.pillar === 'tools');
const tacticsClusters = CLUSTERS.filter(c => c.pillar === 'tactics');

// Cluster descriptions
function getClusterDescription(slug: string): string {
  const descriptions: Record<string, string> = {
    'intro': 'المفاهيم الأساسية للتحليل الفني',
    'patterns': 'أنماط الشموع اليابانية',
    'action': 'تحليل حركة السعر',
    'methods': 'طرق التحليل المتقدمة',
    'momentum': 'قياس قوة الزخم',
    'trend': 'تحديد اتجاه السوق',
    'volatility': 'قياس التذبذب',
    'volume': 'تحليل أحجام التداول',
    'calc': 'حاسبات التداول',
    'charts': 'أدوات الرسم البياني',
    'data': 'مصادر البيانات',
    'trend-tactics': 'استراتيجيات الاتجاه',
    'reversion': 'استراتيجيات الارتداد',
    'intraday': 'التداول اليومي',
    'risk': 'إدارة رأس المال',
  };
  return descriptions[slug] || '';
}

// Custom trading icons for each pillar
const pillarIcons = {
  basics: 'M12 3v4M12 17v4M8 7h8v10H8V7zM10 10v4M14 10v4M6 21h12',
  indicators: 'M3 12h2l2-6 3 12 3-8 2 4h6M3 6h18M3 18h18',
  tools: 'M4 4v16h16M8 4v16M12 4v16M16 4v16M4 8h16M4 12h16M4 16h16M20 4v4h-3',
  tactics: 'M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0M12 12m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0M12 2v4M12 18v4M2 12h4M18 12h4M6 6l3 3M15 15l3 3',
};

// Build pillar data with unified styling
const pillars = [
  {
    id: 'basics' as PillarSlug,
    label: 'الأساسيات',
    labelEn: 'Basics',
    href: '/basics',
    description: PILLARS.basics.description,
    icon: pillarIcons.basics,
    clusters: basicsClusters.map(cluster => ({
      label: cluster.nameAr,
      href: `/basics/${cluster.slug}`,
      description: getClusterDescription(cluster.slug),
    })),
    articles: basicsArticles.slice(0, 2),
  },
  {
    id: 'indicators' as PillarSlug,
    label: 'المؤشرات',
    labelEn: 'Indicators',
    href: '/indicators',
    description: PILLARS.indicators.description,
    icon: pillarIcons.indicators,
    clusters: indicatorsClusters.map(cluster => ({
      label: cluster.nameAr,
      href: `/indicators/${cluster.slug}`,
      description: getClusterDescription(cluster.slug),
    })),
    articles: indicatorsArticles.slice(0, 2),
  },
  {
    id: 'tools' as PillarSlug,
    label: 'الأدوات',
    labelEn: 'Tools',
    href: '/tools',
    description: PILLARS.tools.description,
    icon: pillarIcons.tools,
    clusters: toolsClusters.map(cluster => ({
      label: cluster.nameAr,
      href: `/tools/${cluster.slug}`,
      description: getClusterDescription(cluster.slug),
    })),
    articles: toolsArticles.slice(0, 2),
  },
  {
    id: 'tactics' as PillarSlug,
    label: 'الاستراتيجيات',
    labelEn: 'Tactics',
    href: '/tactics',
    description: PILLARS.tactics.description,
    icon: pillarIcons.tactics,
    clusters: tacticsClusters.map(cluster => ({
      label: cluster.nameAr,
      href: `/tactics/${cluster.slug}`,
      description: getClusterDescription(cluster.slug),
    })),
    articles: tacticsArticles.slice(0, 2),
  },
];
---

<!-- Premium Terminal-Grade Mega Menu -->
<div
  id="mega-menu-panel"
  class="mega-menu-panel"
  role="navigation"
  aria-label="القائمة الرئيسية الموسعة"
  data-mega-menu-panel
  hidden
>
  <!-- Sophisticated Backdrop -->
  <div class="mega-menu-backdrop">
    <div class="backdrop-glass"></div>
    <div class="backdrop-grid"></div>
    <div class="backdrop-gradient"></div>
    <div class="backdrop-teal-line"></div>
  </div>

  <!-- Menu Content -->
  <div class="mega-menu-content">
    <div class="container mx-auto px-6 lg:px-8">
      <!-- 4-Column Pillar Grid -->
      <div class="mega-menu-grid">
        {pillars.map((pillar, pillarIndex) => (
          <div
            class="pillar-column"
            data-pillar-column={pillar.id}
            style={`--pillar-delay: ${pillarIndex * 50}ms`}
          >
            <!-- Pillar Header - Unified Design -->
            <a
              href={pillar.href}
              class="pillar-header group"
              aria-label={`استكشف قسم ${pillar.label}`}
            >
              <!-- Icon Container -->
              <div class="pillar-icon-container">
                <div class="pillar-icon-bg"></div>
                <svg
                  class="pillar-icon"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true"
                >
                  <path d={pillar.icon} />
                </svg>
              </div>

              <!-- Header Content -->
              <div class="pillar-header-content">
                <div class="pillar-title-row">
                  <h3 class="pillar-title">{pillar.label}</h3>
                  <span class="pillar-title-en">{pillar.labelEn}</span>
                  <svg
                    class="pillar-arrow"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    aria-hidden="true"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                  </svg>
                </div>
                <p class="pillar-description">{pillar.description}</p>
              </div>
            </a>

            <!-- Cluster Links - Clean List -->
            <div class="pillar-clusters">
              {pillar.clusters.map((cluster, clusterIndex) => (
                <a
                  href={cluster.href}
                  class="cluster-link group"
                  role="menuitem"
                  tabindex="-1"
                  data-cluster-link
                  style={`--cluster-delay: ${(pillarIndex * 50) + (clusterIndex * 25) + 100}ms`}
                >
                  <span class="cluster-dot" aria-hidden="true"></span>
                  <div class="cluster-content">
                    <span class="cluster-label">{cluster.label}</span>
                    <span class="cluster-desc">{cluster.description}</span>
                  </div>
                  <svg
                    class="cluster-arrow"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    aria-hidden="true"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                  </svg>
                </a>
              ))}
            </div>

            <!-- Featured Articles Section -->
            {pillar.articles.length > 0 && (
              <div class="pillar-articles">
                <div class="articles-header">
                  <svg class="articles-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                  </svg>
                  <span class="articles-heading">أحدث المقالات</span>
                </div>
                <div class="articles-list">
                  {pillar.articles.map((article) => (
                    <a
                      href={`/${article.pillar}/${article.cluster}/${article.slug}`}
                      class="article-link"
                      role="menuitem"
                      tabindex="-1"
                      data-cluster-link
                    >
                      <span class="article-indicator" aria-hidden="true"></span>
                      <span class="article-title">{article.title}</span>
                    </a>
                  ))}
                </div>
              </div>
            )}

            <!-- View All CTA -->
            <a href={pillar.href} class="pillar-cta">
              <span class="pillar-cta-text">عرض الكل</span>
              <span class="pillar-cta-count">{pillar.clusters.length} مواضيع</span>
              <svg class="pillar-cta-arrow" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
            </a>
          </div>
        ))}
      </div>

      <!-- Footer Bar - Trust Signals -->
      <div class="mega-menu-footer">
        <div class="footer-content">
          <div class="footer-trust">
            <div class="trust-item">
              <svg class="trust-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.746 3.746 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.746 3.746 0 011.043 3.296A3.745 3.745 0 0121 12z" />
              </svg>
              <span>محتوى تعليمي موثوق</span>
            </div>
            <div class="trust-divider"></div>
            <div class="trust-item">
              <svg class="trust-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
              </svg>
              <span>4 محاور تعليمية متكاملة</span>
            </div>
            <div class="trust-divider"></div>
            <div class="trust-item">
              <svg class="trust-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l.5 1.5m-.5-1.5h-9.5m0 0l-.5 1.5m.75-9l3-3 2.148 2.148A12.061 12.061 0 0116.5 7.605" />
              </svg>
              <span>تحليل فني متقدم</span>
            </div>
          </div>

          <div class="footer-links">
            <a href="/about" class="footer-link">
              <span>من نحن</span>
            </a>
            <span class="footer-divider"></span>
            <a href="/faq" class="footer-link footer-link-primary">
              <span>الأسئلة الشائعة</span>
              <svg class="footer-link-arrow" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* ═══════════════════════════════════════════════════════════════════════════════
     MEGA MENU PANEL - Terminal Grade Design
     ═══════════════════════════════════════════════════════════════════════════════ */

  .mega-menu-panel {
    position: absolute;
    top: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%) translateY(-12px) scale(0.98);
    width: calc(100% - 2rem);
    max-width: 1400px;
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.3s cubic-bezier(0.16, 1, 0.3, 1),
      visibility 0.3s cubic-bezier(0.16, 1, 0.3, 1),
      transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    pointer-events: none;
    will-change: transform, opacity;
  }

  .mega-menu-panel[hidden] {
    display: block;
  }

  .mega-menu-panel.is-open {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(0) scale(1);
    pointer-events: auto;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     BACKDROP - Sophisticated Glassmorphism
     ═══════════════════════════════════════════════════════════════════════════════ */

  .mega-menu-backdrop {
    position: absolute;
    inset: 0;
    overflow: hidden;
    border-radius: 1rem;
  }

  .backdrop-glass {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.98) 0%, rgba(250, 251, 252, 0.97) 100%);
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    border: 1px solid rgba(226, 232, 240, 0.8);
    border-radius: 1rem;
    box-shadow:
      0 25px 80px rgba(15, 23, 42, 0.12),
      0 12px 40px rgba(15, 23, 42, 0.08),
      0 4px 16px rgba(15, 23, 42, 0.05),
      inset 0 1px 0 rgba(255, 255, 255, 0.9);
  }

  .backdrop-grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(15, 23, 42, 0.02) 1px, transparent 1px),
      linear-gradient(90deg, rgba(15, 23, 42, 0.02) 1px, transparent 1px);
    background-size: 40px 40px;
    border-radius: 1rem;
    opacity: 0;
    transition: opacity 0.5s ease 0.1s;
  }

  .mega-menu-panel.is-open .backdrop-grid {
    opacity: 1;
  }

  .backdrop-gradient {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse 600px 300px at 10% 0%, rgba(8, 145, 178, 0.04) 0%, transparent 70%),
      radial-gradient(ellipse 600px 300px at 90% 100%, rgba(8, 145, 178, 0.03) 0%, transparent 70%);
    border-radius: 1rem;
    opacity: 0;
    transition: opacity 0.5s ease 0.15s;
  }

  .mega-menu-panel.is-open .backdrop-gradient {
    opacity: 1;
  }

  .backdrop-teal-line {
    position: absolute;
    top: 0;
    left: 1.5rem;
    right: 1.5rem;
    height: 3px;
    background: linear-gradient(90deg,
      transparent 0%,
      rgba(8, 145, 178, 0.15) 10%,
      rgba(8, 145, 178, 0.4) 30%,
      #0891B2 50%,
      rgba(8, 145, 178, 0.4) 70%,
      rgba(8, 145, 178, 0.15) 90%,
      transparent 100%
    );
    border-radius: 0 0 2px 2px;
    transform: scaleX(0);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1) 0.1s;
  }

  .mega-menu-panel.is-open .backdrop-teal-line {
    transform: scaleX(1);
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     CONTENT CONTAINER
     ═══════════════════════════════════════════════════════════════════════════════ */

  .mega-menu-content {
    position: relative;
    z-index: 1;
    padding: 1.5rem 0 1rem;
    border-radius: 1rem;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     4-COLUMN PILLAR GRID
     ═══════════════════════════════════════════════════════════════════════════════ */

  .mega-menu-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.25rem;
    margin-bottom: 1.25rem;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     PILLAR COLUMN - Unified Design
     ═══════════════════════════════════════════════════════════════════════════════ */

  .pillar-column {
    display: flex;
    flex-direction: column;
    opacity: 0;
    transform: translateY(12px);
    animation: pillarReveal 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    animation-delay: var(--pillar-delay, 0ms);
    animation-play-state: paused;
  }

  .mega-menu-panel.is-open .pillar-column {
    animation-play-state: running;
  }

  @keyframes pillarReveal {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     PILLAR HEADER - Clean Unified Style
     ═══════════════════════════════════════════════════════════════════════════════ */

  .pillar-header {
    display: flex;
    align-items: flex-start;
    gap: 0.875rem;
    padding: 1rem;
    background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(255, 255, 255, 0.5) 100%);
    border-radius: 0.875rem;
    margin-bottom: 0.625rem;
    border: 1px solid rgba(226, 232, 240, 0.6);
    text-decoration: none;
    transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .pillar-header:hover {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.8) 100%);
    border-color: rgba(8, 145, 178, 0.2);
    box-shadow: 0 4px 16px rgba(15, 23, 42, 0.04), 0 2px 8px rgba(8, 145, 178, 0.06);
    transform: translateY(-1px);
  }

  .pillar-header:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px white, 0 0 0 4px #0891B2;
  }

  .pillar-icon-container {
    position: relative;
    flex-shrink: 0;
  }

  .pillar-icon-bg {
    width: 2.5rem;
    height: 2.5rem;
    background: linear-gradient(135deg, rgba(8, 145, 178, 0.08) 0%, rgba(8, 145, 178, 0.04) 100%);
    border-radius: 0.625rem;
    border: 1px solid rgba(8, 145, 178, 0.12);
    transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .pillar-header:hover .pillar-icon-bg {
    background: linear-gradient(135deg, rgba(8, 145, 178, 0.12) 0%, rgba(8, 145, 178, 0.06) 100%);
    border-color: rgba(8, 145, 178, 0.2);
    transform: scale(1.05);
  }

  .pillar-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 1.25rem;
    height: 1.25rem;
    color: #0891B2;
    transition: all 0.25s ease;
  }

  .pillar-header:hover .pillar-icon {
    transform: translate(-50%, -50%) scale(1.1);
    color: #0E7490;
  }

  .pillar-header-content {
    flex: 1;
    min-width: 0;
  }

  .pillar-title-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
  }

  .pillar-title {
    font-family: var(--font-heading, 'Noto Kufi Arabic', sans-serif);
    font-size: 1rem;
    font-weight: 700;
    color: #0F172A;
    letter-spacing: -0.01em;
    line-height: 1.3;
    margin: 0;
    transition: color 0.2s ease;
  }

  .pillar-header:hover .pillar-title {
    color: #0891B2;
  }

  .pillar-title-en {
    font-size: 0.625rem;
    font-weight: 600;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .pillar-arrow {
    width: 0.875rem;
    height: 0.875rem;
    color: #CBD5E1;
    margin-right: auto;
    opacity: 0;
    transform: translateX(4px);
    transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .pillar-header:hover .pillar-arrow {
    opacity: 1;
    transform: translateX(0);
    color: #0891B2;
  }

  .pillar-description {
    font-size: 0.75rem;
    color: #64748b;
    line-height: 1.5;
    margin: 0;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     CLUSTER LINKS - Clean Minimal Style
     ═══════════════════════════════════════════════════════════════════════════════ */

  .pillar-clusters {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    flex: 1;
  }

  .cluster-link {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    text-decoration: none;
    opacity: 0;
    transform: translateX(8px);
    animation: clusterReveal 0.35s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    animation-delay: var(--cluster-delay, 0ms);
    animation-play-state: paused;
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .mega-menu-panel.is-open .cluster-link {
    animation-play-state: running;
  }

  @keyframes clusterReveal {
    from { opacity: 0; transform: translateX(8px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .cluster-link:hover {
    background: linear-gradient(90deg, rgba(8, 145, 178, 0.06) 0%, rgba(8, 145, 178, 0.02) 100%);
    transform: translateX(-2px);
  }

  .cluster-link:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px white, 0 0 0 4px #0891B2;
    background: rgba(8, 145, 178, 0.04);
  }

  .cluster-dot {
    flex-shrink: 0;
    width: 5px;
    height: 5px;
    background: #CBD5E1;
    border-radius: 50%;
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .cluster-link:hover .cluster-dot {
    background: #0891B2;
    transform: scale(1.3);
    box-shadow: 0 0 8px rgba(8, 145, 178, 0.3);
  }

  .cluster-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .cluster-label {
    display: block;
    font-size: 0.8125rem;
    font-weight: 600;
    color: #1E293B;
    line-height: 1.4;
    transition: color 0.2s ease;
  }

  .cluster-link:hover .cluster-label {
    color: #0F172A;
  }

  .cluster-desc {
    display: block;
    font-size: 0.6875rem;
    color: #94a3b8;
    line-height: 1.3;
    transition: color 0.2s ease;
  }

  .cluster-link:hover .cluster-desc {
    color: #64748b;
  }

  .cluster-arrow {
    flex-shrink: 0;
    width: 0.75rem;
    height: 0.75rem;
    color: #CBD5E1;
    opacity: 0;
    transform: translateX(4px);
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .cluster-link:hover .cluster-arrow {
    opacity: 1;
    transform: translateX(0);
    color: #0891B2;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     FEATURED ARTICLES - Minimal Style
     ═══════════════════════════════════════════════════════════════════════════════ */

  .pillar-articles {
    margin-top: 0.625rem;
    padding-top: 0.625rem;
    border-top: 1px solid rgba(226, 232, 240, 0.6);
  }

  .articles-header {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    margin-bottom: 0.375rem;
    padding-right: 0.25rem;
  }

  .articles-icon {
    width: 0.875rem;
    height: 0.875rem;
    color: #94a3b8;
  }

  .articles-heading {
    font-size: 0.625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #94a3b8;
  }

  .articles-list {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .article-link {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    padding: 0.375rem 0.5rem;
    border-radius: 0.375rem;
    text-decoration: none;
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .article-link:hover {
    background: rgba(248, 250, 252, 0.8);
    transform: translateX(-2px);
  }

  .article-link:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px white, 0 0 0 4px #0891B2;
  }

  .article-indicator {
    flex-shrink: 0;
    width: 3px;
    height: 3px;
    margin-top: 0.4rem;
    background: #CBD5E1;
    border-radius: 50%;
    transition: all 0.2s ease;
  }

  .article-link:hover .article-indicator {
    background: #0891B2;
    transform: scale(1.3);
  }

  .article-title {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    font-size: 0.6875rem;
    font-weight: 500;
    color: #475569;
    line-height: 1.5;
    transition: color 0.2s ease;
  }

  .article-link:hover .article-title {
    color: #1E293B;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     CTA BUTTON - Unified Teal Style
     ═══════════════════════════════════════════════════════════════════════════════ */

  .pillar-cta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 0.875rem;
    margin-top: 0.625rem;
    border-radius: 0.5rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-decoration: none;
    color: #0891B2;
    background: linear-gradient(135deg, rgba(8, 145, 178, 0.06) 0%, rgba(8, 145, 178, 0.02) 100%);
    border: 1px solid rgba(8, 145, 178, 0.12);
    transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .pillar-cta:hover {
    background: linear-gradient(135deg, rgba(8, 145, 178, 0.1) 0%, rgba(8, 145, 178, 0.05) 100%);
    border-color: rgba(8, 145, 178, 0.25);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(8, 145, 178, 0.12);
  }

  .pillar-cta:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px white, 0 0 0 4px #0891B2;
  }

  .pillar-cta-text {
    color: #0891B2;
  }

  .pillar-cta-count {
    color: #94a3b8;
    font-weight: 500;
    margin-right: auto;
  }

  .pillar-cta-arrow {
    width: 0.75rem;
    height: 0.75rem;
    color: #0891B2;
    transition: transform 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .pillar-cta:hover .pillar-cta-arrow {
    transform: translateX(-3px);
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     FOOTER BAR - Trust Signals
     ═══════════════════════════════════════════════════════════════════════════════ */

  .mega-menu-footer {
    border-top: 1px solid rgba(226, 232, 240, 0.6);
    padding-top: 1rem;
  }

  .footer-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
  }

  .footer-trust {
    display: flex;
    align-items: center;
    gap: 1.25rem;
  }

  .trust-item {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .trust-icon {
    width: 1rem;
    height: 1rem;
    color: #0891B2;
    opacity: 0.8;
  }

  .trust-item span {
    font-size: 0.6875rem;
    font-weight: 500;
    color: #64748b;
  }

  .trust-divider {
    width: 1px;
    height: 0.875rem;
    background: linear-gradient(180deg, transparent 0%, #E2E8F0 50%, transparent 100%);
  }

  .footer-links {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .footer-link {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.375rem 0.625rem;
    border-radius: 0.375rem;
    font-size: 0.6875rem;
    font-weight: 500;
    color: #64748b;
    text-decoration: none;
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .footer-link:hover {
    color: #1E293B;
    background: rgba(248, 250, 252, 0.8);
  }

  .footer-link:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px white, 0 0 0 4px #0891B2;
  }

  .footer-link-primary {
    color: #0891B2;
    background: rgba(8, 145, 178, 0.06);
    border: 1px solid rgba(8, 145, 178, 0.1);
  }

  .footer-link-primary:hover {
    color: #0E7490;
    background: rgba(8, 145, 178, 0.1);
    border-color: rgba(8, 145, 178, 0.2);
  }

  .footer-link-arrow {
    width: 0.75rem;
    height: 0.75rem;
    transition: transform 0.2s ease;
  }

  .footer-link-primary:hover .footer-link-arrow {
    transform: translateX(-2px);
  }

  .footer-divider {
    width: 1px;
    height: 0.75rem;
    background: #E2E8F0;
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     RESPONSIVE
     ═══════════════════════════════════════════════════════════════════════════════ */

  @media (max-width: 1023px) {
    .mega-menu-panel {
      display: none !important;
    }
  }

  @media (min-width: 1280px) {
    .mega-menu-panel {
      max-width: 1320px;
    }

    .mega-menu-grid {
      gap: 1.5rem;
    }
  }

  @media (min-width: 1536px) {
    .mega-menu-panel {
      max-width: 1440px;
    }

    .mega-menu-grid {
      gap: 2rem;
    }
  }

  /* ═══════════════════════════════════════════════════════════════════════════════
     REDUCED MOTION
     ═══════════════════════════════════════════════════════════════════════════════ */

  @media (prefers-reduced-motion: reduce) {
    .mega-menu-panel {
      transition: opacity 0.15s ease;
      transform: translateX(-50%);
    }

    .mega-menu-panel.is-open {
      transform: translateX(-50%);
    }

    .pillar-column,
    .cluster-link {
      animation: none;
      opacity: 1;
      transform: none;
    }

    .backdrop-teal-line {
      transition: none;
      transform: scaleX(1);
    }

    .backdrop-grid,
    .backdrop-gradient {
      transition: none;
      opacity: 1;
    }

    .cluster-link:hover,
    .article-link:hover,
    .pillar-cta:hover,
    .pillar-header:hover {
      transform: none;
    }
  }
</style>

<script>
  // MegaMenu Keyboard Navigation
  document.addEventListener('DOMContentLoaded', () => {
    const megaMenu = document.querySelector('[data-mega-menu-panel]') as HTMLElement;
    if (!megaMenu) return;

    const clusterLinks = megaMenu.querySelectorAll('[data-cluster-link]');
    const pillarColumns = megaMenu.querySelectorAll('[data-pillar-column]');

    // Keyboard navigation within mega menu
    clusterLinks.forEach((link) => {
      link.addEventListener('keydown', (e: Event) => {
        const keyEvent = e as KeyboardEvent;
        const currentColumn = (link as HTMLElement).closest('[data-pillar-column]');
        const allLinksInColumn = currentColumn?.querySelectorAll('[data-cluster-link]');

        if (!allLinksInColumn) return;

        const currentIndexInColumn = Array.from(allLinksInColumn).indexOf(link);

        switch (keyEvent.key) {
          case 'ArrowDown':
            keyEvent.preventDefault();
            const nextLink = allLinksInColumn[currentIndexInColumn + 1] || allLinksInColumn[0];
            (nextLink as HTMLElement).focus();
            break;

          case 'ArrowUp':
            keyEvent.preventDefault();
            const prevLink = allLinksInColumn[currentIndexInColumn - 1] || allLinksInColumn[allLinksInColumn.length - 1];
            (prevLink as HTMLElement).focus();
            break;

          case 'ArrowRight': // In RTL, this moves to the previous column
            keyEvent.preventDefault();
            navigateToColumn(-1, currentColumn, currentIndexInColumn);
            break;

          case 'ArrowLeft': // In RTL, this moves to the next column
            keyEvent.preventDefault();
            navigateToColumn(1, currentColumn, currentIndexInColumn);
            break;

          case 'Home':
            keyEvent.preventDefault();
            (allLinksInColumn[0] as HTMLElement).focus();
            break;

          case 'End':
            keyEvent.preventDefault();
            (allLinksInColumn[allLinksInColumn.length - 1] as HTMLElement).focus();
            break;
        }
      });
    });

    function navigateToColumn(direction: number, currentColumn: Element | null, currentIndex: number) {
      if (!currentColumn) return;

      const columns = Array.from(pillarColumns);
      const currentColumnIndex = columns.indexOf(currentColumn);
      const targetColumn = columns[currentColumnIndex + direction];

      if (targetColumn) {
        const linksInTargetColumn = targetColumn.querySelectorAll('[data-cluster-link]');
        const targetIndex = Math.min(currentIndex, linksInTargetColumn.length - 1);
        (linksInTargetColumn[targetIndex] as HTMLElement)?.focus();
      }
    }

    // GPU acceleration optimization
    pillarColumns.forEach((column) => {
      column.addEventListener('mouseenter', () => {
        (column as HTMLElement).style.willChange = 'transform';
      });

      column.addEventListener('mouseleave', () => {
        setTimeout(() => {
          (column as HTMLElement).style.willChange = '';
        }, 300);
      });
    });
  });
</script>
