---
/**
 * TrustBadge.astro
 * Premium trust indicator badges for ITQQAN fintech platform
 *
 * Features:
 * - License verification badge
 * - Security badge
 * - Compliance badge
 * - Customizable variants and sizes
 * - Premium fintech styling
 * - Full RTL support and accessibility
 * - Hover effects with tooltips
 */

export type BadgeType = 'license' | 'security' | 'compliance' | 'verified' | 'reviewed';

export interface Props {
  /** Type of trust badge */
  type: BadgeType;
  /** Custom label (overrides default) */
  label?: string;
  /** Detailed description shown on hover */
  description?: string;
  /** Badge size */
  size?: 'sm' | 'md' | 'lg';
  /** Visual variant */
  variant?: 'filled' | 'outlined' | 'subtle';
  /** Show tooltip on hover */
  showTooltip?: boolean;
  /** Link to verification page */
  href?: string;
  /** Additional CSS classes */
  class?: string;
}

const {
  type,
  label,
  description,
  size = 'md',
  variant = 'filled',
  showTooltip = true,
  href,
  class: className = '',
} = Astro.props;

// Badge configurations
const badgeConfig: Record<BadgeType, { label: string; description: string; icon: string }> = {
  license: {
    label: 'مرخص',
    description: 'وسيط مرخص من هيئة تنظيمية معتمدة',
    icon: `<path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`,
  },
  security: {
    label: 'آمن',
    description: 'حماية متقدمة للبيانات والأموال',
    icon: `<rect x="3" y="11" width="18" height="11" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/><path d="M7 11V7a5 5 0 0110 0v4" fill="none" stroke="currentColor" stroke-width="2"/>`,
  },
  compliance: {
    label: 'ممتثل',
    description: 'يلتزم بالمعايير التنظيمية الدولية',
    icon: `<path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`,
  },
  verified: {
    label: 'موثق',
    description: 'تم التحقق من صحة المعلومات',
    icon: `<circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M9 12l2 2 4-4" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>`,
  },
  reviewed: {
    label: 'مراجع',
    description: 'تمت مراجعته بواسطة خبراء ماليين',
    icon: `<path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`,
  },
};

const config = badgeConfig[type];
const badgeLabel = label || config.label;
const badgeDescription = description || config.description;

// Unique ID for tooltip
const tooltipId = `tooltip-${Math.random().toString(36).slice(2, 9)}`;

// Build class list
const classes = [
  'trust-badge',
  `trust-badge--${type}`,
  `trust-badge--${size}`,
  `trust-badge--${variant}`,
  className,
].filter(Boolean).join(' ');

// Element type
const Tag = href ? 'a' : 'div';
const linkAttrs = href ? { href, target: '_blank', rel: 'noopener noreferrer' } : {};
---

<Tag
  class={classes}
  aria-describedby={showTooltip ? tooltipId : undefined}
  {...linkAttrs}
>
  <span class="trust-badge__icon" aria-hidden="true">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      aria-hidden="true"
    >
      <Fragment set:html={config.icon} />
    </svg>
  </span>
  <span class="trust-badge__label">{badgeLabel}</span>

  {showTooltip && (
    <div
      id={tooltipId}
      class="trust-badge__tooltip"
      role="tooltip"
    >
      <span class="trust-badge__tooltip-text">{badgeDescription}</span>
      <span class="trust-badge__tooltip-arrow" aria-hidden="true" />
    </div>
  )}
</Tag>

<style>
  /* ═══════════════════════════════════════════════════════════════════════════
     BASE BADGE STYLES
     ═══════════════════════════════════════════════════════════════════════════ */

  .trust-badge {
    --badge-color: #d5a035;
    --badge-bg: rgba(213, 160, 53, 0.1);
    --badge-border: rgba(213, 160, 53, 0.2);

    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.875rem;
    font-family: var(--font-body);
    font-weight: 600;
    text-decoration: none;
    border-radius: 9999px;
    cursor: default;
    transition:
      background-color 0.2s ease,
      border-color 0.2s ease,
      transform 0.2s ease,
      box-shadow 0.2s ease;
  }

  a.trust-badge {
    cursor: pointer;
  }

  a.trust-badge:hover {
    transform: translateY(-1px);
  }

  a.trust-badge:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 3px #FFFFFF,
      0 0 0 6px var(--badge-color);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     BADGE TYPES (Colors)
     ═══════════════════════════════════════════════════════════════════════════ */

  .trust-badge--license {
    --badge-color: #d5a035;
    --badge-bg: rgba(213, 160, 53, 0.1);
    --badge-border: rgba(213, 160, 53, 0.25);
  }

  .trust-badge--security {
    --badge-color: #3B82F6;
    --badge-bg: rgba(59, 130, 246, 0.1);
    --badge-border: rgba(59, 130, 246, 0.25);
  }

  .trust-badge--compliance {
    --badge-color: #8B5CF6;
    --badge-bg: rgba(139, 92, 246, 0.1);
    --badge-border: rgba(139, 92, 246, 0.25);
  }

  .trust-badge--verified {
    --badge-color: #d5a035;
    --badge-bg: rgba(213, 160, 53, 0.1);
    --badge-border: rgba(213, 160, 53, 0.25);
  }

  .trust-badge--reviewed {
    --badge-color: #F59E0B;
    --badge-bg: rgba(245, 158, 11, 0.1);
    --badge-border: rgba(245, 158, 11, 0.25);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     VARIANTS
     ═══════════════════════════════════════════════════════════════════════════ */

  /* Filled */
  .trust-badge--filled {
    background-color: var(--badge-color);
    color: #FFFFFF;
    border: 1px solid var(--badge-color);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .trust-badge--filled:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .trust-badge--filled .trust-badge__icon svg {
    stroke: #FFFFFF;
  }

  /* Outlined */
  .trust-badge--outlined {
    background-color: #FFFFFF;
    color: var(--badge-color);
    border: 2px solid var(--badge-border);
  }

  .trust-badge--outlined:hover {
    background-color: var(--badge-bg);
    border-color: var(--badge-color);
  }

  .trust-badge--outlined .trust-badge__icon svg {
    stroke: var(--badge-color);
  }

  /* Subtle */
  .trust-badge--subtle {
    background-color: var(--badge-bg);
    color: var(--badge-color);
    border: 1px solid transparent;
  }

  .trust-badge--subtle:hover {
    border-color: var(--badge-border);
  }

  .trust-badge--subtle .trust-badge__icon svg {
    stroke: var(--badge-color);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     SIZES
     ═══════════════════════════════════════════════════════════════════════════ */

  .trust-badge--sm {
    padding: 0.375rem 0.625rem;
    font-size: 0.75rem;
    gap: 0.375rem;
  }

  .trust-badge--sm .trust-badge__icon svg {
    width: 14px;
    height: 14px;
  }

  .trust-badge--md {
    padding: 0.5rem 0.875rem;
    font-size: 0.875rem;
    gap: 0.5rem;
  }

  .trust-badge--md .trust-badge__icon svg {
    width: 18px;
    height: 18px;
  }

  .trust-badge--lg {
    padding: 0.625rem 1.125rem;
    font-size: 1rem;
    gap: 0.625rem;
  }

  .trust-badge--lg .trust-badge__icon svg {
    width: 22px;
    height: 22px;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     ICON
     ═══════════════════════════════════════════════════════════════════════════ */

  .trust-badge__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .trust-badge__icon svg {
    width: 18px;
    height: 18px;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     LABEL
     ═══════════════════════════════════════════════════════════════════════════ */

  .trust-badge__label {
    white-space: nowrap;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     TOOLTIP
     ═══════════════════════════════════════════════════════════════════════════ */

  .trust-badge__tooltip {
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    z-index: 50;

    padding: 0.625rem 0.875rem;
    min-width: 180px;
    max-width: 280px;

    background-color: #102A43;
    color: #FFFFFF;
    border-radius: 0.5rem;
    box-shadow: 0 8px 24px rgba(15, 23, 42, 0.25);

    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.2s ease,
      visibility 0s linear 0.2s,
      transform 0.2s ease;
    transform: translateX(-50%) translateY(4px);

    pointer-events: none;
  }

  .trust-badge:hover .trust-badge__tooltip,
  .trust-badge:focus-within .trust-badge__tooltip {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(0);
    transition:
      opacity 0.2s ease 0.1s,
      visibility 0s linear 0s,
      transform 0.2s ease 0.1s;
  }

  .trust-badge__tooltip-text {
    display: block;
    font-size: 0.8125rem;
    font-weight: 400;
    line-height: 1.5;
    text-align: center;
  }

  .trust-badge__tooltip-arrow {
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 7px solid transparent;
    border-right: 7px solid transparent;
    border-top: 7px solid #102A43;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     REDUCED MOTION
     ═══════════════════════════════════════════════════════════════════════════ */

  @media (prefers-reduced-motion: reduce) {
    .trust-badge,
    .trust-badge__tooltip {
      transition: none;
    }

    a.trust-badge:hover {
      transform: none;
    }
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     PRINT STYLES
     ═══════════════════════════════════════════════════════════════════════════ */

  @media print {
    .trust-badge {
      border: 1px solid currentColor;
      box-shadow: none;
    }

    .trust-badge__tooltip {
      display: none;
    }
  }
</style>
