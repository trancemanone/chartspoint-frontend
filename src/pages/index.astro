---
/**
 * Homepage - chartspoint.com
 * Technical Analysis Education Platform
 *
 * Institutional-grade fintech design featuring:
 * - Premium HomeHero with glassmorphism
 * - 4-Pillar content navigation grid
 * - Trust signals and educational focus
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import HomeHero from '../components/hero/HomeHero.astro';
import PillarsGrid from '../components/sections/PillarsGrid.astro';
import { getAllPosts, transformToArticle } from '../lib/wordpress';
import { PILLARS, CLUSTERS, type PillarSlug } from '../lib/types';

// Fetch latest posts for featured section
let featuredArticles: any[] = [];
try {
  const postsResponse = await getAllPosts(8, 1);
  featuredArticles = postsResponse.data.map(transformToArticle);
} catch (error) {
  console.error('Error fetching posts:', error);
}

// Get pillar data with clusters
const pillarData = Object.entries(PILLARS).map(([slug, pillar]) => {
  const clusters = CLUSTERS.filter(c => c.pillar === slug as PillarSlug);
  return {
    ...pillar,
    clusterCount: clusters.length,
    clusters: clusters.slice(0, 4),
  };
});

// Homepage schema
const homeSchema = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "تشارتس بوينت",
  "alternateName": "ChartsPoint",
  "description": "تعليم التحليل الفني للأسواق المالية",
  "url": "https://chartspoint.com",
  "inLanguage": "ar",
  "publisher": {
    "@type": "Organization",
    "name": "ChartsPoint",
    "logo": {
      "@type": "ImageObject",
      "url": "https://chartspoint.com/logo.png"
    }
  }
});
---

<BaseLayout
  title="تشارتس بوينت - تعليم التحليل الفني"
  description="تعليم التحليل الفني بعيدا عن الضجيج. فهم الشارت قبل مطاردة الإشارات. التحليل الفني كمنهج لا كحظ."
  schema={homeSchema}
>
  <!-- Premium Hero Section -->
  <HomeHero />

  <!-- 4-Pillar Navigation Grid -->
  <PillarsGrid />

  <!-- Featured Articles Section -->
  {featuredArticles.length > 0 && (
    <section class="featured-section py-16 lg:py-24 bg-white">
      <div class="container mx-auto px-4 lg:px-6">
        <!-- Section Header -->
        <div class="section-header text-center mb-12">
          <h2 class="section-title font-heading text-3xl md:text-4xl font-bold text-navy-900 mb-4">
            أحدث المقالات
          </h2>
          <p class="section-subtitle text-lg text-slate-600 max-w-2xl mx-auto">
            مقالات تعليمية حديثة في التحليل الفني وإدارة المخاطر
          </p>
        </div>

        <!-- Articles Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
          {featuredArticles.slice(0, 4).map((article) => {
            const pillarColor = PILLARS[article.pillar as PillarSlug]?.color || '#3B82F6';
            return (
              <a
                href={`/${article.pillar}/${article.cluster}/${article.slug}/`}
                class="article-card group relative bg-white rounded-xl border border-slate-200 overflow-hidden transition-all duration-300 hover:shadow-lg hover:-translate-y-1"
              >
                <!-- Pillar Color Accent -->
                <div class="absolute top-0 right-0 left-0 h-1" style={`background-color: ${pillarColor}`}></div>

                <!-- Featured Image -->
                {article.featuredImage && (
                  <div class="aspect-[16/10] overflow-hidden">
                    <img
                      src={article.featuredImage.url}
                      alt={article.featuredImage.alt || article.title}
                      class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                      loading="lazy"
                    />
                  </div>
                )}

                <!-- Content -->
                <div class="p-5">
                  <!-- Pillar Badge -->
                  <div class="mb-3">
                    <span
                      class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-semibold"
                      style={`background-color: ${pillarColor}15; color: ${pillarColor}`}
                    >
                      {PILLARS[article.pillar as PillarSlug]?.nameAr || article.pillar}
                    </span>
                  </div>

                  <!-- Title -->
                  <h3 class="font-heading text-lg font-bold text-navy-900 mb-2 line-clamp-2 group-hover:text-navy-700 transition-colors">
                    {article.title}
                  </h3>

                  <!-- Excerpt -->
                  {article.excerpt && (
                    <p class="text-slate-600 text-sm line-clamp-2 mb-4">
                      {article.excerpt}
                    </p>
                  )}

                  <!-- Meta -->
                  <div class="flex items-center justify-between text-sm text-slate-500">
                    <span class="flex items-center gap-1.5">
                      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      {article.readingTime} دقائق
                    </span>
                    <span class="read-more flex items-center gap-1 font-medium transition-all duration-200 group-hover:gap-2" style={`color: ${pillarColor}`}>
                      اقرأ المزيد
                      <svg class="w-4 h-4 rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                      </svg>
                    </span>
                  </div>
                </div>
              </a>
            );
          })}
        </div>
      </div>
    </section>
  )}

  <!-- Clusters Overview - Detailed Navigation -->
  <section class="clusters-section py-16 lg:py-24 bg-slate-50">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="section-header text-center mb-12">
        <h2 class="section-title font-heading text-3xl md:text-4xl font-bold text-navy-900 mb-4">
          استكشف المحتوى
        </h2>
        <p class="section-subtitle text-lg text-slate-600 max-w-2xl mx-auto">
          محتوى تعليمي منظم حسب الموضوع والمستوى
        </p>
      </div>

      <div class="space-y-8">
        {pillarData.map((pillar) => (
          <div class="pillar-overview bg-white rounded-xl border border-slate-200 p-6 lg:p-8">
            <!-- Pillar Header -->
            <div class="flex items-center gap-4 mb-6">
              <div
                class="w-12 h-12 rounded-xl flex items-center justify-center"
                style={`background-color: ${pillar.color}15`}
              >
                <div class="w-4 h-4 rounded-full" style={`background-color: ${pillar.color}`}></div>
              </div>
              <div>
                <h3 class="text-xl font-bold text-navy-900 font-heading">{pillar.nameAr}</h3>
                <p class="text-sm text-slate-500">{pillar.clusterCount} مجموعات تخصصية</p>
              </div>
              <a
                href={`/${pillar.slug}/`}
                class="mr-auto flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-200 hover:translate-x-[-4px]"
                style={`color: ${pillar.color}; background-color: ${pillar.color}10`}
              >
                <span>استكشف الكل</span>
                <svg class="w-4 h-4 rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                </svg>
              </a>
            </div>

            <!-- Clusters Grid -->
            <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
              {pillar.clusters.map((cluster) => (
                <a
                  href={`/${pillar.slug}/${cluster.slug}/`}
                  class="cluster-card group p-4 rounded-lg border border-slate-100 bg-slate-50 hover:bg-white hover:border-slate-200 hover:shadow-sm transition-all duration-200"
                >
                  <div class="flex items-center gap-3">
                    <span
                      class="w-2 h-2 rounded-full transition-transform duration-200 group-hover:scale-125"
                      style={`background-color: ${pillar.color}`}
                    ></span>
                    <span class="text-navy-800 font-medium group-hover:text-navy-900 transition-colors">
                      {cluster.nameAr}
                    </span>
                  </div>
                </a>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Trust Section -->
  <section class="trust-section py-16 lg:py-20 bg-navy-900">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-2xl lg:text-3xl font-bold text-white mb-6 font-heading">
          لماذا <span class="text-gold-400">ChartsPoint</span>؟
        </h2>

        <div class="grid md:grid-cols-3 gap-8 mb-12">
          <div class="trust-item p-6">
            <div class="w-14 h-14 mx-auto mb-4 rounded-xl bg-white/10 flex items-center justify-center">
              <svg class="w-7 h-7 text-gold-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
              </svg>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">محتوى تعليمي موثق</h3>
            <p class="text-navy-200 text-sm">مقالات مكتوبة بمنهجية علمية مع مراجع موثوقة</p>
          </div>

          <div class="trust-item p-6">
            <div class="w-14 h-14 mx-auto mb-4 rounded-xl bg-white/10 flex items-center justify-center">
              <svg class="w-7 h-7 text-gold-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">بدون توصيات</h3>
            <p class="text-navy-200 text-sm">لا نقدم توصيات أو إشارات تداول - تعليم فقط</p>
          </div>

          <div class="trust-item p-6">
            <div class="w-14 h-14 mx-auto mb-4 rounded-xl bg-white/10 flex items-center justify-center">
              <svg class="w-7 h-7 text-gold-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">التركيز على المخاطر</h3>
            <p class="text-navy-200 text-sm">إدارة المخاطر أولاً - قبل الحديث عن الأرباح</p>
          </div>
        </div>

        <!-- Risk Disclaimer -->
        <div class="risk-disclaimer p-6 rounded-xl bg-yellow-500/10 border border-yellow-500/20">
          <div class="flex items-start gap-4">
            <svg class="w-6 h-6 flex-shrink-0 text-yellow-400 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <p class="text-right text-sm text-navy-200 leading-relaxed">
              <strong class="text-yellow-400">تنبيه مهم:</strong> المحتوى المقدم تعليمي فقط ولا يعتبر نصيحة استثمارية. التداول في الأسواق المالية ينطوي على مخاطر عالية وقد تخسر رأس مالك. التحليل الفني لا يضمن نتائج. تأكد من فهمك الكامل للمخاطر قبل اتخاذ أي قرار.
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* ═══════════════════════════════════════════════════════════════════════════
     SECTION STYLES
     ═══════════════════════════════════════════════════════════════════════════ */

  .section-title {
    position: relative;
    display: inline-block;
  }

  .section-title::after {
    content: '';
    position: absolute;
    bottom: -8px;
    right: 0;
    width: 60%;
    height: 3px;
    background: linear-gradient(90deg, #d5a035 0%, transparent 100%);
    border-radius: 2px;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     ARTICLE CARDS
     ═══════════════════════════════════════════════════════════════════════════ */

  .article-card {
    box-shadow: 0 2px 8px rgba(15, 23, 42, 0.04), 0 4px 16px rgba(15, 23, 42, 0.04);
  }

  .article-card:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px white, 0 0 0 6px #d5a035;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     TRUST SECTION
     ═══════════════════════════════════════════════════════════════════════════ */

  .trust-item {
    border-radius: 1rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.06);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     REDUCED MOTION
     ═══════════════════════════════════════════════════════════════════════════ */

  @media (prefers-reduced-motion: reduce) {
    .article-card,
    .cluster-card,
    .read-more {
      transition: none;
    }

    .article-card:hover,
    .cluster-card:hover {
      transform: none;
    }

    .article-card:hover img {
      transform: none;
    }
  }
</style>
